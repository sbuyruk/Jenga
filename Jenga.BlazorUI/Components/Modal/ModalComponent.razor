@rendermode InteractiveServer
@using Jenga.Utility.Modal
@inject IModalService ModalService

@if (IsVisible)
{
    <div class="modal-backdrop"></div>

    <div class="modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">@Request?.Title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @onclick="Cancel"></button>
                </div>
                <div class="modal-body">
                    <p>@Request?.Message</p>
                </div>
                <div class="modal-footer">
                    <div class="modal-actions">
                        <button class="btn btn-success" @onclick="Confirm">Evet</button>
                        <button class="btn btn-danger" @onclick="Cancel">Hayır</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private ModalRequest? Request;
    private bool IsVisible;

    protected override void OnInitialized()
    {
        ModalService.OnShow += ShowModal;
    }

    private Task ShowModal(ModalRequest request)
    {
        Request = request;
        IsVisible = true;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private void Confirm()
    {
        Request?.OnResult?.Invoke(true);
        Close();
    }

    private void Cancel()
    {
        Request?.OnResult?.Invoke(false);
        Close();
    }

    private void Close()
    {
        IsVisible = false;
        Request = null;
    }

    public void Dispose()
    {
        ModalService.OnShow -= ShowModal;
    }
}
