@page "/tbys/tasinmazbagisci-list"
@using Jenga.DataAccess.Repositories.IRepository
@inject IUnitOfWork UnitOfWork
@inject IJSRuntime JS


<h3>Taşınmaz Bağışçı Listesi</h3>

@if (bagiscilar == null)
{
    <p><em>Yükleniyor...</em></p>
}
else if (!bagiscilar.Any())
{
    <p><em>Kayıt bulunamadı.</em></p>
}
else
{


    <table class="table table-striped">
        <thead>
            <tr>
                <th>Adı</th>
                <th>Soyadı</th>
                <th>TC Kimlik No</th>
                <th>İl</th>
                <th>İlçe</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in bagiscilar)
            {
                <tr>
                    <td>@item.Adi</td>
                    <td>@item.Soyadi</td>
                    <td>@item.TCKimlikNo</td>
                    <td>@item.Ili</td>
                    <td>@item.Ilcesi</td>
                    <td>
                        <a class="btn btn-primary btn-sm me-1" href="/tbys/tasinmazbagisci-create/@item.Id">Düzenle</a>
                        <button class="btn btn-danger btn-sm" @onclick="@(() => ConfirmDelete(item.Id))">Sil</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<TasinmazBagisci>? bagiscilar;
    private List<TasinmazBagisci> Items = new();
    private async Task ConfirmDelete(int id)
    {
        bool confirmed = await JS.InvokeAsync<bool>("confirm", "Silmek istediğinizden emin misiniz?");
        if (confirmed)
        {
            var entity = await UnitOfWork.TasinmazBagisci.GetFirstOrDefaultAsync(x => x.Id == id);
            if (entity != null)
            {
                UnitOfWork.TasinmazBagisci.Remove(entity);
                await UnitOfWork.CommitAsync();
                bagiscilar = (await UnitOfWork.TasinmazBagisci.GetAllAsync()).ToList(); // Listeyi güncelle
            }
        }
    }
    protected override async Task OnInitializedAsync()
    {
        bagiscilar = (await UnitOfWork.TasinmazBagisci.GetAllAsync()).ToList();
    }
    @inject NavigationManager NavigationManager

    private void EditItem(int id)
    {
       NavigationManager.NavigateTo($"/tbys/tasinmazbagisci-create/{id}");
    }

    private async Task DeleteItem(int id)
    {
        var entity = await UnitOfWork.TasinmazBagisci.GetFirstOrDefaultAsync(x => x.Id == id);
        if (entity is not null)
        {
            UnitOfWork.TasinmazBagisci.Remove(entity);
            await UnitOfWork.CommitAsync();
            bagiscilar = (await UnitOfWork.TasinmazBagisci.GetAllAsync()).ToList();
        }
    }
}
